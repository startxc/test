<!doctype html>
<html lang="zh-CH">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>{$title}</title>
<link rel="stylesheet" href="__PUBLIC__/Css/bootstrap.css" />
<link rel="stylesheet" href="__PUBLIC__/Css/layout.css" />
<script type="text/javascript" src="__PUBLIC__/Js/jquery.min.js"></script>
</head>

<!-- 暂无待付款的订单 -->
<if condition="$order_status eq 'created' && empty($orderList)">
<body class="bg-white">
<div class="noorder"><i class="icon1"></i></div>
<p class="noordertip">暂无待付款的订单</p>
</body>
<!-- 暂无待发货的订单 -->
<elseif condition="$order_status eq 'payed' && empty($orderList)"/>
<body class="bg-white">
<div class="noorder"><i class="icon2"></i></div>
<p class="noordertip">暂无待发货的订单</p>
</body>
<!-- 暂无待发货的订单 -->
<elseif condition="$order_status eq 'shipped' && empty($orderList)"/>
<body class="bg-white">
<div class="noorder"><i class="icon3"></i></div>
<p class="noordertip">暂无待收货的订单</p>
</body>
<!-- 订单列表 -->
<else />
<body>
<ul class="userorder fouritem2 mb10 clearfix">
	<li><a href="__URL__/myOrder">0<br>所有</a></li>
	<li><a href="__URL__/myOrder/order_status/created">0<br>待付款</a></li>
	<li><a href="__URL__/myOrder/order_status/payed">0<br>待发货</a></li>
	<li><a href="__URL__/myOrder/order_status/shipped">0<br>待收货</a></li>
</ul>
<volist name="orderList" id="vo">
<div class="order-div">
    <div class="order-t clearfix"><span class="fl">订单号：{$vo.order_no}</span><span class="fr">{$vo.create_time|date='Y-m-d H:i',###}</span></div>
    <volist name="vo.goodsList" id="goods">
    <div class="cart-item">
        <span class="pic"><a class="pro-img" href="#"><img src="{$goods.image}"></a></span>
        <div class="proinfos clearfix">
            <div class="proinfor">
                <a class="proinfotxt" href="#">
                    <p class="tit">{$goods.goods_name}</p>
                    <p class="total"><span class="total-l">总量：250g</span><span class="total-r">数量：{$goods.number}</span></p>
                    <p class="status">状态：
                    <eq name="vo.order_status" value="created">待付款</eq>
                    <eq name="vo.order_status" value="payed">待发货</eq>
                    <eq name="vo.order_status" value="shipped">配送路上</eq>
                    <eq name="vo.order_status" value="received">交易完成</eq>
                    <eq name="vo.order_status" value="canceled">已取消</eq>
                    <eq name="vo.order_status" value="refund">已退款</eq>
                    <eq name="vo.order_status" value="refund_appiled">已申请退款</eq>
                    </p>
                </a>
            </div>
            <span class="pri">{$goods.price}元</span>
        </div>
    </div>
    </volist>
    <div class="orderlinks clearfix">
    	<!-- 删除订单 -->
    	<if condition="$vo.order_status eq 'created' || $vo.order_status eq 'canceled' || $vo.order_status eq 'refund' || $vo.order_status eq 'received'">
    	<a id="deleteOrder-{$vo.id}" class="i-delete2" href="javascript:;"></a>
    	</if>
    	<!-- 付款 -->
    	<if condition="$vo.order_status eq 'created'">
        <span class="f-opay fr"><a class="btn-pay" href="javascript:;">付款</a></span>
        </if>
        <!-- 确认收货 -->
    	<if condition="$vo.order_status eq 'shipped'">
        <span class="f-opay fr"><a id="confirmOrder-{$vo.id}" class="btn-pay" href="javascript:;">确认收货</a></span>
        </if>
    </div>
</div>
</volist>
<script type="text/javascript">
$(function() {
	$.ajax({
	    type: 'GET',
	    url: '__URL__/getOrderStatusCount',
	    success: function(json) {
        	var result = eval(json);
        	$('.userorder li a').eq(0).html(result.order_num + '<br>所有');
    		$('.userorder li a').eq(1).html(result.created_num + '<br>待付款');
    		$('.userorder li a').eq(2).html(result.payed_num + '<br>待发货');
    		$('.userorder li a').eq(3).html(result.shipped_num + '<br>待收货');
		}
	});
	$('[id^="deleteOrder-"]').click(function() {
        var id = $(this).attr('id').split('-')[1];
        var r = confirm("你确认要删除订单吗?")
        if (r == true) {
        	$.ajax({
    		    type: 'POST',
    		    data: 'id=' + id,
    		    url: '__URL__/deleteOrder',
    		    success: function(json) {
    	        	var result = eval(json);
    	    		if (result.status == 0) {
    	    			alert(result.prompt);
    	        	} else if (result.status == 1)  {
    	        		window.location.href = '__URL__/myOrder';
    	            }
        		}
    		});
        }
		return false;
    });
	$('[id^="confirmOrder-"]').click(function() {
        var id = $(this).attr('id').split('-')[1];
        var r = confirm("你确认要确认收货吗?")
        if (r == true) {
        	$.ajax({
    		    type: 'POST',
    		    data: 'id=' + id,
    		    url: '__URL__/confirmOrder',
    		    success: function(json) {
    	        	var result = eval(json);
    	    		if (result.status == 0) {
    	    			alert(result.prompt);
    	        	} else if (result.status == 1)  {
    	        		window.location.href = '__URL__/myOrder';
    	            }
        		}
    		});
        }
		return false;
    });
});
</script>
</body>
</if>
</html>